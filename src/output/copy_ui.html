<!doctype html>
<html><head><meta charset="utf-8"/><title>Polymarket Copy UI</title>
<style>body{font-family:Arial;margin:20px} input{margin:4px} table{border-collapse:collapse;width:100%} td,th{border:1px solid #ddd;padding:6px} .row{display:flex;gap:10px;flex-wrap:wrap}</style>
</head><body>
<h2>Copy Trading UI</h2>
<div class="row">
<input id="leader" placeholder="Leader 0x..." size="44"/>
<input id="funds" placeholder="Allocated funds" value="1000"/>
<input id="maxTrade" placeholder="Max trade %" value="5"/>
<input id="maxExposure" placeholder="Max exposure %" value="70"/>
<input id="minCopy" placeholder="Min copy USD" value="1"/>
<input id="poll" placeholder="Poll secs" value="3"/>
<label><input type="checkbox" id="execute"/> Execute orders (experimental)</label>
<button onclick="configure()">Guardar config</button>
<button onclick="startCopy()">Start copy</button>
<button onclick="stopCopy()">Stop</button>
</div>
<p id="status"></p>
<h3>Movimientos copiados</h3>
<table><thead><tr><th>Hora</th><th>Mercado</th><th>Leader $</th><th>Copiado $</th><th>Settled</th><th>PnL</th></tr></thead><tbody id="moves"></tbody></table>
<h3>Beneficio diario</h3><pre id="daily"></pre>
<h3>Beneficio historico (acumulado)</h3><pre id="historical"></pre>
<script>
async function api(path,opts={}){const r=await fetch(path,{headers:{'content-type':'application/json'},...opts}); if(!r.ok) throw new Error(await r.text()); return r.json();}
async function configure(){
 const payload={leader:leader.value,allocated_funds:funds.value,max_trade_pct:maxTrade.value,max_total_exposure_pct:maxExposure.value,min_copy_usd:minCopy.value,poll_interval_secs:Number(poll.value),risk_level:'balanced',execute_orders:execute.checked};
 await api('/api/configure',{method:'POST',body:JSON.stringify(payload)}); await refresh();
}
async function startCopy(){await api('/api/start',{method:'POST'}); await refresh();}
async function stopCopy(){await api('/api/stop',{method:'POST'}); await refresh();}
function bars(v){const n=Math.min(40,Math.abs(Math.trunc(Number(v)))); return v<0?'-'.repeat(n)+'|':'|'+ '+'.repeat(n)}
async function refresh(){
 try{ const s=await api('/api/state');
 status.textContent = `Configured: ${s.configured} | Monitoring: ${s.monitoring} | Movimientos: ${s.movements.length}`;
 if(s.config){leader.value=s.config.leader; funds.value=s.config.allocated_funds; maxTrade.value=s.config.max_trade_pct; maxExposure.value=s.config.max_total_exposure_pct; minCopy.value=s.config.min_copy_usd; poll.value=s.config.poll_interval_secs; execute.checked=!!s.config.execute_orders;}
 moves.innerHTML = s.movements.slice().reverse().map(m=>`<tr><td>${m.timestamp}</td><td>${m.market}</td><td>${m.leader_value}</td><td>${m.copied_value}</td><td>${m.settled}</td><td>${m.pnl}</td></tr>`).join('');
 daily.textContent = (s.daily_pnl||[]).map(d=>`${d[0]} ${bars(Number(d[1]))} ${d[1]}`).join('\n');
 historical.textContent = (s.historical_pnl||[]).map(d=>`${d[0]} ${bars(Number(d[1]))} ${d[1]}`).join('\n');
 }catch(e){status.textContent='Error: '+e.message}
}
setInterval(refresh,2000); refresh();
</script>
</body></html>
